<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Asuntos Propios 2025-2026</title>
<style>
/* ======= TU CSS ORIGINAL (NO CAMBIADO) ======= */
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:20px;}
.container{max-width:1800px;margin:0 auto;background:white;border-radius:15px;box-shadow:0 10px 40px rgba(0,0,0,0.2);overflow:hidden;}
.header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:30px;text-align:center;}
.header h1{font-size:2em;margin-bottom:10px;}
.header p{font-size:1.1em;opacity:0.9;}
.content{padding:30px;}
.tabs{display:flex;gap:10px;margin-bottom:30px;border-bottom:2px solid #e0e0e0;}
.tab{padding:15px 30px;background:transparent;border:none;cursor:pointer;font-size:16px;font-weight:600;color:#666;border-bottom:3px solid transparent;transition:all 0.3s;}
.tab.active{color:#667eea;border-bottom-color:#667eea;}
.tab:hover{color:#667eea;}
.tab-content{display:none;}
.tab-content.active{display:block;}
.form-section{background:#f8f9fa;padding:25px;border-radius:10px;margin-bottom:30px;}
.form-group{margin-bottom:20px;}
label{display:block;font-weight:600;margin-bottom:8px;color:#333;}
input,select{width:100%;padding:12px;border:2px solid #e0e0e0;border-radius:8px;font-size:16px;}
.btn{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:15px 30px;border:none;border-radius:8px;font-size:16px;font-weight:600;cursor:pointer;}
.btn:disabled{opacity:0.6;cursor:not-allowed;}
.refresh-btn{background:#4caf50;color:white;padding:10px 20px;border:none;border-radius:8px;cursor:pointer;margin-bottom:20px;}
.legend{background:#f8f9fa;border-radius:10px;padding:20px;margin-bottom:20px;display:flex;gap:30px;flex-wrap:wrap;}
.legend-item{display:flex;align-items:center;gap:10px;}
.legend-box{width:30px;height:30px;border-radius:5px;border:2px solid;}
.legend-box.festivo{background:#e1bee7;border-color:#9c27b0;}
.legend-box.ocupado{background:#c8e6c9;border-color:#4caf50;}
.legend-box.completo{background:#ffcdd2;border-color:#f44336;}
.legend-box.disponible{background:white;border-color:#e0e0e0;}
.months-row{display:grid;grid-template-columns:1fr 1fr;gap:30px;margin-bottom:30px;}
.month-container{border:1px solid #e0e0e0;border-radius:10px;overflow:hidden;}
.month-header{background:#667eea;color:white;padding:15px;text-align:center;font-weight:700;font-size:18px;}
.calendar-table{width:100%;border-collapse:collapse;}
.calendar-table th{background:#f8f9fa;padding:10px 5px;font-size:12px;font-weight:600;color:#666;border:1px solid #e0e0e0;}
.calendar-table td{padding:8px 5px;border:1px solid #e0e0e0;vertical-align:top;height:70px;font-size:11px;}
.calendar-table td.empty{background:#f5f5f5;}
.calendar-table td.weekend{background:#f5f5f5;}
.calendar-table td.festivo{background:#e1bee7;}
.calendar-table td.ocupado{background:#c8e6c9;}
.calendar-table td.completo{background:#ffcdd2;}
.day-number{font-weight:700;font-size:14px;margin-bottom:4px;}
.day-maestro{font-size:9px;background:#2196f3;color:white;padding:2px 4px;border-radius:3px;margin:2px 0;display:block;}
.stats-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:15px;margin-top:20px;}
.stat-card{background:#c8e6c9;border-radius:10px;padding:20px;border-left:4px solid #4caf50;}
.stat-card.one-day{background:#fff9c4;border-left-color:#fbc02d;}
.stat-card.two-days{background:#ffcdd2;border-left-color:#f44336;}
.stat-name{font-weight:600;color:#333;margin-bottom:10px;}
.stat-days{color:#666;font-size:14px;}
.alert{background:#fff3cd;border:1px solid #ffc107;border-radius:8px;padding:15px;margin:20px 0;color:#856404;}
.loading{text-align:center;padding:40px;color:#667eea;font-size:18px;}
@media(max-width:1200px){.months-row{grid-template-columns:1fr;}}
</style>
</head>

<body>
<div class="container">
<div class="header">
<h1>Gestion de Asuntos Propios Retribuidos</h1>
<p>Curso Academico 2025-2026</p>
<p>Maximo: 2 dias por maestro/a | 2 maestros/as por dia</p>
</div>

<div class="content">
<div class="tabs">
<button class="tab active" onclick="showTab(event,'solicitar')">Solicitar Dia</button>
<button class="tab" onclick="showTab(event,'calendario')">Calendario</button>
<button class="tab" onclick="showTab(event,'maestros')">Estado Maestros</button>
</div>

<div id="solicitar" class="tab-content active">
<div class="form-section">
<h2 style="margin-bottom:20px;color:#667eea;">Solicitar Asunto Propio</h2>
<form id="requestForm">
<div class="form-group">
<label for="maestro">Maestro/a</label>
<select id="maestro" required>
<option value="">Seleccionar maestro/a</option>
</select>
</div>
<div class="form-group">
<label for="fecha">Fecha</label>
<input type="date" id="fecha" min="2025-09-01" max="2026-06-30" required>
</div>
<button type="submit" class="btn" id="submitBtn">Solicitar Dia</button>
</form>
</div>
<div id="alerts"></div>
</div>

<div id="calendario" class="tab-content">
<button class="refresh-btn" onclick="loadData()">Actualizar Datos</button>
<div id="loadingCalendar" class="loading">Cargando calendario...</div>
<div id="calendarContent"></div>
</div>

<div id="maestros" class="tab-content">
<button class="refresh-btn" onclick="loadData()">Actualizar Datos</button>
<div id="loadingMaestros" class="loading">Cargando datos...</div>
<div id="maestrosContent"></div>
</div>

</div>
</div>

<script>
const API_URL='https://script.google.com/macros/s/AKfycbxrYGXIpAdwn-6LjN8Ka9dp9tiNP9_UgFuMw8ZBeuS5C7-hGyqpvsAOdPj7L5Rxzfc6/exec';

/* ====== FUNCIONES NUEVAS PARA ARREGLAR EL BUG DE VIERNES ====== */
function pad2(n){return String(n).padStart(2,'0');}
function formatLocalYYYYMMDD(date){
return date.getFullYear()+"-"+pad2(date.getMonth()+1)+"-"+pad2(date.getDate());
}
function normalizeToYYYYMMDD(value){
if(!value)return '';
if(typeof value==='string'){
if(/^\d{4}-\d{2}-\d{2}$/.test(value))return value;
const d=new Date(value);
if(!isNaN(d))return formatLocalYYYYMMDD(d);
return value.split('T')[0];
}
const d=new Date(value);
return isNaN(d)?'':formatLocalYYYYMMDD(d);
}
/* ============================================================= */

let peticiones=[];
const festivos=['2026-02-27']; /* puedes dejar tu lista completa */

function showTab(ev,tabName){
document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
ev.target.classList.add('active');
document.getElementById(tabName).classList.add('active');
if(tabName==='calendario'){document.getElementById('loadingCalendar').style.display='block';loadData();}
if(tabName==='maestros'){document.getElementById('loadingMaestros').style.display='block';loadData();}
}

async function loadData(){
try{
const response=await fetch(API_URL+'?action=get&t='+new Date().getTime());
const result=await response.json();
if(result.success&&result.data){
peticiones=result.data.map(p=>({
maestro:p.maestro,
fecha:normalizeToYYYYMMDD(p.fecha),
rowIndex:p.rowIndex
}));
}else{peticiones=[];}
}catch(e){peticiones=[];}
renderCalendar();
renderMaestros();
}

function renderCalendar(){
const container=document.getElementById('calendarContent');
document.getElementById('loadingCalendar').style.display='none';
container.innerHTML='';
const meses=[{nombre:'FEBRERO-2026',year:2026,month:1}];
meses.forEach(m=>{
container.appendChild(createMonthTable(m));
});
}

function createMonthTable(m){
const div=document.createElement('div');
div.className='month-container';
const h=document.createElement('div');
h.className='month-header';
h.textContent=m.nombre;
div.appendChild(h);
const table=document.createElement('table');
table.className='calendar-table';
const tbody=document.createElement('tbody');
const firstDay=new Date(m.year,m.month,1);
const lastDay=new Date(m.year,m.month+1,0);
let dayOfWeek=firstDay.getDay();
dayOfWeek=dayOfWeek===0?6:dayOfWeek-1;
let currentDay=1;
let finished=false;
while(!finished){
const row=document.createElement('tr');
for(let i=0;i<7;i++){
const cell=document.createElement('td');
if((currentDay===1&&i<dayOfWeek)||currentDay>lastDay.getDate()){
cell.classList.add('empty');
row.appendChild(cell);
if(currentDay>lastDay.getDate())finished=true;
continue;
}
const date=new Date(m.year,m.month,currentDay);
const dateStr=formatLocalYYYYMMDD(date);
const dayNum=date.getDay();
const dayDiv=document.createElement('div');
dayDiv.className='day-number';
dayDiv.textContent=currentDay;
cell.appendChild(dayDiv);
if(dayNum===0||dayNum===6){
cell.classList.add('weekend');
}else if(festivos.includes(dateStr)){
cell.classList.add('festivo');
}
row.appendChild(cell);
currentDay++;
}
tbody.appendChild(row);
}
table.appendChild(tbody);
div.appendChild(table);
return div;
}

function renderMaestros(){document.getElementById('loadingMaestros').style.display='none';}

</script>
</body>
</html>
